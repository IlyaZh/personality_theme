<!DOCTYPE html>
<html lang="{{@site.locale}}" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    
    {{!-- Dynamic title and meta --}}
    <title>{{#is "post"}}{{title}} - {{@site.title}}{{else}}{{#is "page"}}{{title}} - {{@site.title}}{{else}}{{#is "tag"}}{{tag.name}} - {{@site.title}}{{else}}{{#is "author"}}{{primary_author.name}} - {{@site.title}}{{else}}{{meta_title}}{{/is}}{{/is}}{{/is}}{{/is}}</title>
    <meta name="description" content="{{#if meta_description}}{{meta_description}}{{else}}{{@site.description}}{{/if}}">
    
    {{!-- Open Graph / Facebook --}}
    <meta property="og:type" content="{{#is "post"}}article{{else}}website{{/is}}">
    <meta property="og:title" content="{{meta_title}}">
    <meta property="og:description" content="{{#if meta_description}}{{meta_description}}{{else}}{{@site.description}}{{/if}}">
    <meta property="og:url" content="{{url absolute="true"}}">
    <meta property="og:site_name" content="{{@site.title}}">
    {{#if feature_image}}
    <meta property="og:image" content="{{img_url feature_image size="l"}}">
    {{else}}
    {{#if @site.cover_image}}
    <meta property="og:image" content="{{img_url @site.cover_image size="l"}}">
    {{/if}}
    {{/if}}
    
    {{!-- Twitter --}}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{meta_title}}">
    <meta name="twitter:description" content="{{#if meta_description}}{{meta_description}}{{else}}{{@site.description}}{{/if}}">
    {{#if feature_image}}
    <meta name="twitter:image" content="{{img_url feature_image size="l"}}">
    {{else}}
    {{#if @site.cover_image}}
    <meta name="twitter:image" content="{{img_url @site.cover_image size="l"}}">
    {{/if}}
    {{/if}}
    
    {{!-- Canonical URL --}}
    <link rel="canonical" href="{{url absolute="true"}}">
    
    {{!-- Theme styles --}}
    <link rel="stylesheet" type="text/css" href="{{asset "css/screen.css"}}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    {{!-- Favicon --}}
    <link rel="icon" type="image/svg+xml" href="{{asset 'favicon.svg'}}">
    <link rel="alternate icon" href="{{asset 'favicon.ico'}}">
    <link rel="mask-icon" href="{{asset 'favicon.svg'}}" color="#4f46e5">
    
    {{!-- RSS Feed --}}
    <link rel="alternate" type="application/rss+xml" title="{{@site.title}}" href="{{@site.url}}/rss/">
    
    {{!-- Ghost head --}}
    {{ghost_head}}
</head>
<body class="min-h-screen bg-base-100 {{body_class}}">
    
    {{!-- Announcement Bar --}}
    {{> announcement}}
    
    {{!-- Navigation --}}
    {{> navigation}}
    
    {{!-- Main content area --}}
    <main>
        {{{body}}}
    </main>
    
    {{!-- Footer --}}
    {{> footer}}
    
    {{!-- Theme Toggle Script --}}
    <script>
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const html = document.documentElement;

        // Load saved theme or default to light
        const currentTheme = localStorage.getItem('theme') || 'light';
        html.setAttribute('data-theme', currentTheme);
        updateThemeIcon(currentTheme);

        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
            });
        }

        function updateThemeIcon(theme) {
            if (themeIcon) {
                if (theme === 'light') {
                    themeIcon.className = 'fas fa-moon text-xl';
                } else {
                    themeIcon.className = 'fas fa-sun text-xl';
                }
            }
        }

        // Mobile menu close functionality
        function closeMobileMenu() {
            const dropdown = document.querySelector('.dropdown');
            if (dropdown) {
                const checkbox = dropdown.querySelector('[tabindex="0"]');
                if (checkbox) {
                    checkbox.blur();
                }
            }
        }

        // Close mobile menu when clicking on links
        document.querySelectorAll('.dropdown-content a').forEach(link => {
            link.addEventListener('click', closeMobileMenu);
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.querySelector('.dropdown');
            
            // Don't close if clicking on form elements
            if (event.target.matches('input, textarea, button[type="submit"], .form-control, .form-control *')) {
                return;
            }
            
            if (dropdown && !dropdown.contains(event.target)) {
                closeMobileMenu();
            }
        });

        // Close mobile menu with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeMobileMenu();
            }
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>

    {{!-- Ghost Search --}}
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="{{@site.content_api_key}}" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="{{@site.url}}" crossorigin="anonymous"></script>
    <script>
        window.addEventListener('DOMContentLoaded', function () {
            if (window.sodoSearch) {
                window.sodoSearch.init({
                    key: '{{@site.content_api_key}}',
                    url: '{{@site.url}}',
                    trigger: '[data-ghost-search]',
                    styles: {
                        accent: 'hsl(var(--p))'
                    }
                });
            }
        });
    </script>

    {{!-- Ghost foot --}}
    {{ghost_foot}}
</body>
</html>
